==================================
Экспорт документов
==================================

Экспорт подразумевает загрузка документов из Сервера "Опт-Сервис" в Учетную систему.

Экспорт осуществляется в формате XML.

Формат запроса
============================================

Пример: https://erp.opt-service/acc_get_docs/

Для экспорта документов необходимо сформировать и отправить запрос на сервер "Опт-Сервис".

Запрос представляет структуру xml файла.

Корневой элемент <root>

Тег "item" содержит информацию о виде необходимых документов для выгрузки.

Используются следующие атрибуты тега "Item":

* **type** - вид документа для экспорта. Используемые значения: "order" - заявки / "ret" - возвраты 

* **onlynew** - экспорт новых документов (ранее незагруженных в учетную систему). Используемые значения: 1

* **startdate/enddate** - интервал дат времени создания документов для загрузки. Формат даты указывается в формате "ГГГГ-ММ-ДД ЧЧ:ММ:СС" (необязательный)

* *limit* - Количество документов к экспорту. (необязательный)


Примеры::
  
 <?xml version="1.0" encoding="UTF-8"?>
 <root>
   <item type="order" onlynew="1"/>
 </root>
 
 <?xml version="1.0" encoding="UTF-8"?>
 <root>
   <item type="order" startdate="2013-05-01 00:00:00" enddate="2013-05-01 23:59:59"/>
 </root>

 <?xml version="1.0" encoding="UTF-8"?>
 <root>
   <item type="order" onlynew="1" agent="bd72d8fc-55bc-11d9-848a-00112f43529a"/>
 </root>

Формат ответа
=================================

Экспорт осуществляется в формате XML.

Корневой элемент <root>.

Каждый документ, как объект загрузки в Учетную систему, имеет тег "doc"

Используются следующие атрибуты тега "doc":

* **id** - уникальный идентификатор документа на сервере "Меркурий"

* **type** - вид документа. Используемые значения: "order".

**Реквизиты документа содержатся в теге <properties>, подчиненному тегу <doc>**.

Каждый реквизит документа иммет собственный тег с определенным значением тега.

Используемые теги:

* <firm_id> - уникальный идентификатор юр. лица поставщика.

* <firm_name> - наименование юр. лица поставщика.

* <customer_id> - уникальный идентификатор покупателя в учетной системе.

* <customer_name> - наименование покупателя.

* <contract_id> - уникальный идентификатор договора покупателя в учетной системе. 

* <contract_name> - наименование договора.

* <procelist_id> - уникальный идентификатор типа цен в учетной системе.

* <pricelist_name> - наименование типа цен.

* <store_id> - уникальный идентификатор склада.

* <store_name> - наименование склада.

* <shop_id> - уникальный идентификатор торговой точки покупателя в учетной системе.

* <shop_name> - наименование торговой точки покупателя.

* <shop_address> - адрес торговой торговой точки покупателя.

* <agent_id> - уникальный идентификатор агента (физ. лица) в учетной системе.

* <isbonus> - признак бонуса.

* <comment> - комментарий к документу.

* <total_weight> - общая сумма по документу.

* <delivery_date> - указанная дата доставки.

* <lastedit_time> - время последнего редактирования документа.

* <vizit_id> - идентификатор визита в рамках которого был оформлен заказ.

* <payment> - тип оплаты.

* <payment_type> - вид типа оплаты.

* <code_prome> - код акции.

**Строки табличных частей содержатся в теге <items>, подчиненному тегу <doc>**.

Тег <items> имеет следующие атрибуты:

* id - тип табличной части документа. Допустимые значения: 1 - табличная часть товары.

Значения каждой строки содержится в атрибутах тега <Item>, который является дочерним тегу <Items>.

Используются следующие атрибуты тега <Item>:

* object_id - уникальный идентификатор товара/услуги/тары в учетной системе.

* object_name - наименование товара/услиги/тары.

* object_property - дополнительное свойство товара/услиги/тары.

* amount - количество товара/услуги/тары.

* price - цена товара/услуги/тары.

* unit_id - уникальный идентификатор единицы измерения в учетной системе.

* unit_k - коэффициент перерасчета единицы измерения.

* weight - общий вес по строке.

Пример::

 <?xml version="1.0" encoding="UTF-8"?>
 <root>
   <doc id="204f4de8-3fad-45b6-a4ba-f9d4fab0b828" type="order">
     <properties>
	   <agent_id>14ed8bae-55bd-11d9-848a-00112f43529a</agent_id>
	   <firm_id>14ed8bae-55bd-11d9-848a</firm_id>
	   <firm_name>ООО Поставщик</firm_name>
	   <comment />
	   <contract_name>Основной договор</contract_name>
	   <isbonus>false</isbonus>
	   <customer_id>53390e27-401f-11dc-abc6-0015e9b8c48d</customer_id>
	   <contract_id>53390e28-401f-11dc-abc6-0015e9b8c48d</contract_id>
	   <shop_address>Москва г, Севастопольский проезд 34</shop_address>
	   <shop_name>ИП "Гришичкин"</shop_name>
	   <shop_id>53390e27-401f-11dc-abc6-0015e9b8c48d</shop_id>
       <vizit_id>76261e1a-d835-400f-924c-61253cb693b2</vizit_id>
	   <lastedit_time>2013-04-16 15:05:27</lastedit_time>
	   <pricelist_id>53390e28-481f-11dc-abc6-0815e9b8c48d</pricelist_id>
	   <total_weight>0</total>
	   <pricelist_name>Розничная</pricelist_name>
	   <delicery_date>2013-04-16 15:05:27</delicery_date>
	   <customer_name>ИП "Гришичкин"</customer_name>
	 </properties>
	 <items id="1">
	   <item amount="5.0" object_id="e8a71fab-55bc-11d9-848a-00112f43529a" object_name="Мужские сапоги с натуральным мехом" object_property="" price="2100.33" unit_id="e8a71fac-55bc-11d9-848a-00112f43529a" unit_k="1.0" weight="0.0" />
	   <item amount="2.0" object_id="bd72d92c-55bc-11d9-848a-00112f43529a" object_name="Кофеварка BRAUN KF22R" object_property="" price="19932.0" unit_id="bd72d92d-55bc-11d9-848a-00112f43529a" unit_k="1.0" weight="0.0" />
	   <item amount="36.0" object_id="cbcf4934-55bc-11d9-848a-00112f43529a" object_name="СТИНОЛ 101" object_property="" price="21185.0" unit_id="cbcf4935-55bc-11d9-848a-00112f43529a"	unit_k="1.0" weight="0.0" />
     </items>
   </doc>
   <doc id="a9b6f3d2-6d4c-466c-95bb-98dc4db10caf" type="order">
     <properties>
	   <agent_id>14ed8bae-55bd-11d9-848a-00112f43529a</agent_id>
	   <firm_id>14ed8bae-55bd-11d9-848a</firm_id>
	   <firm_name>ООО Поставщик</firm_name>
	   <comment />
	   <contract_name>Основной договор</contract_name>
	   <isbonus>false</isbonus>
	   <customer_id>53390e27-401f-11dc-abc6-0015e9b8c48d</customer_id>
	   <contract_id>53390e28-401f-11dc-abc6-0015e9b8c48d</contract_id>
	   <shop_address>Москва г, Севастопольский проезд 34</shop_address>
	   <shop_name>ИП "Гришичкин"</shop_name>
	   <shop_id>53390e27-401f-11dc-abc6-0015e9b8c48d</shop_id>
	   <vizit_id>5acb118c-dcd2-47e9-a1a0-e6dfcc8957af</vizit_id>
	   <lastedit_time>2013-04-16 14:56:44</lastedit_time>
	   <pricelist_id>53390e28-481f-11dc-abc6-0815e9b8c48d</pricelist_id>
	   <total_weight>0</total>
	   <pricelist_name>Розничная</pricelist_name>
	   <delivery_date>2013-04-16 14:56:43</delivery_date>
	   <customer_name>ИП "Гришичкин"</customer_name>
     </properties>
     <items id="1">
	   <item amount="2.0" object_id="e8a71fab-55bc-11d9-848a-00112f43529a" object_name="Мужские сапоги с натуральным мехом" object_property="" price="2100.33" unit_id="e8a71fac-55bc-11d9-848a-00112f43529a" unit_k="1.0" weight="0.0" />
	   <item amount="2.0" object_id="bd72d92c-55bc-11d9-848a-00112f43529a" object_name="КофеваркаBRAUN KF22R" object_property="" price="19932.0" unit_id="bd72d92d-55bc-11d9-848a-00112f43529a"	unit_k="1.0" weight="0.0" />
     </items>
   </doc>
 </root>


Подтверждение загрузки документов
============================================

После удачного экспорта документов в учетную систему необходимо отправить запрос на "Опт-Сервис" о подтверждении загрузки документов.

Пример: http://erp.opt-service.info/acc_accept_docs/

Тег <doc> содержит значение идентификатора документа на сервере "Опт-Сервис".

Теги содержит следующие атрибуты:

* id - уникальный идентификатор документа в учетной системе.

* info - информация о документе (номер, наименование).



Пример::

 <?xml version="1.0" encoding="UTF-8"?>
 <root>
   <doc id="cf5e055e-0585-11e3-9716-000c296d2c77" info="Заказ покупателя ТД0030 от 15.08.2013 12:36:42">83a12660-bf24-4f9a-ae72-ff4e79396f91</doc>
 </root>


Подтвеждение от сервера "Опт-Сервис" о изменении статуса документа как загруженного в учетную систему имеет следующий формат.

Значение тега <doc> - результат изменения статуса документа на сервере "Меркурий".

Атрубут "id" - идентификатор документа.

Пример::

 <?xml version="1.0" encoding="UTF-8"?>
 <root>
   <doc id="53cdb5cf-a69b-4d68-a062-a9171036e15c">OK</doc>
   <doc id="54cdb5cf-a69b-4d68-a062-a9171036e15c">ERROR</doc>
 </root>





   

   
   
   






   
   

    


